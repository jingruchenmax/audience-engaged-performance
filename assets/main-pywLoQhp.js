import{i as T,g as D,r as d,o as I,s as B,a as j,u as y,p as M,b as C}from"./index.esm2017-CJ5YLr7D.js";const P={apiKey:"AIzaSyAz8yYM7fno_lWOgJvrQ09ElrgS2MsbxoY",authDomain:"odetojoy-3044e.firebaseapp.com",databaseURL:"https://odetojoy-3044e-default-rtdb.firebaseio.com",projectId:"odetojoy-3044e",storageBucket:"odetojoy-3044e.firebasestorage.app",messagingSenderId:"745234947202",appId:"1:745234947202:web:7a13bb889fc1ea3abd689b"},x=T(P),m=D(x),b={dnb:new Audio("audio/Rhyth.wav"),bells:new Audio("audio/Wind.wav"),brass:new Audio("audio/Brass.wav"),piano:new Audio("audio/Strings.wav")};Object.values(b).forEach(e=>{e.loop=!0,e.preload="auto",e.volume=0,e.muted=!1});const h=`user_${Math.random().toString(36).substring(2,10)}`,i=d(m,`users/${h}`);I(i).remove();const R=document.querySelectorAll(".group-button"),p=document.getElementById("group-page"),$=document.getElementById("group-title"),a=document.getElementById("main-button"),z=document.getElementById("home");let n=null,t=null,c="#333",w=null,s=null,r=!1;function E(e,u,o=300){if(!e)return;const f=Math.ceil(o/16),S=(u-e.volume)/f;let g=0;function v(){e&&(g++,e.volume=Math.min(Math.max(0,e.volume+S),1),g<f&&requestAnimationFrame(v))}requestAnimationFrame(v)}async function A(){const e=await j(d(m,"globalTimestamp"));e.exists()?w=e.val():console.warn("No global timestamp available.")}R.forEach(e=>{e.addEventListener("click",()=>{n=e.dataset.group,t=b[n],c=getComputedStyle(document.documentElement).getPropertyValue(`--color-${n}`).trim(),document.documentElement.style.setProperty("--active-color",c),a.style.backgroundColor=c,$.textContent=`${e.textContent} Mode`,B(i,{instrument:n,playing:!1,joinedAt:C(),activationRecords:[]}),A(),z.classList.remove("active"),p.classList.add("active")})});async function L(){if(await A(),!t||r)return;r=!0,p.classList.add("active-playing"),isNaN(t.duration)&&await new Promise(o=>{t.addEventListener("canplaythrough",o,{once:!0})});const e=(Date.now()-w)/1e3,u=t.duration||60;t.currentTime=e%u;try{await t.play(),E(t,1,300),s=Date.now(),y(i,{playing:!0})}catch(o){console.warn("Audio play failed:",o)}}function l(){r&&(r=!1,t&&(p.classList.remove("active-playing"),E(t,0),t.pause(),t.currentTime=0,y(i,{playing:!1}),s&&(M(d(m,`users/${h}/activationRecords`),{start:s,end:Date.now()}),s=null)))}a.addEventListener("mousedown",L);a.addEventListener("mouseup",l);a.addEventListener("mouseleave",l);a.addEventListener("touchstart",e=>{e.preventDefault(),L()},{passive:!1});a.addEventListener("touchend",l);a.addEventListener("touchcancel",l);
